<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Campus E-Commerce</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:linear-gradient(135deg,#141e30,#243b55);
  color:#fff;
  padding:20px;
}
.container{
  max-width:1100px;
  margin:auto;
}
h1{
  text-align:center;
  margin-bottom:5px;
}
p{
  text-align:center;
  opacity:.85;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:20px;
  margin-top:30px;
}
.card{
  background:rgba(255,255,255,0.12);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.4);
}
.card img{
  width:100%;
  height:160px;
  object-fit:cover;
  border-radius:14px;
}
.card h3{
  margin:10px 0 4px;
}
.card p{
  text-align:left;
  font-size:14px;
}
button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background:#22c55e;
  color:#fff;
  font-size:15px;
}
button:hover{
  background:#16a34a;
}

/* CART */
.cart{
  margin-top:30px;
}
.item{
  background:#fff;
  color:#111;
  border-radius:12px;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.item button{
  width:auto;
  padding:6px 12px;
  background:#ef4444;
}
.total{
  font-size:18px;
  margin-top:10px;
}
input,
textarea,
select {
  color: #0f172a;   /* FORCE visible text */
  background: #fff;
}
.bot-message .bubble {
  color: #0f172a !important;
  font-size: 0.95rem;
  line-height: 1.4;
}
/* üî• FIX CHAT INPUT BAR ISSUE */
#chatPopup button {
  width: auto !important;
  margin-top: 0 !important;
  padding: 10px 18px;
  flex-shrink: 0;
}

#chatPopup input {
  margin-top: 0 !important;
}
</style>
</head>

<body>
<div class="container">
<h1>üõí Campus Market</h1>
<p>Buy ‚Ä¢ Sell ‚Ä¢ Exchange within your campus</p>

<!-- PRODUCTS -->
<div class="grid" id="products"></div>

<!-- CART -->
<div class="cart card">
  <h2>üß∫ Cart</h2>
  <div id="cartItems"></div>
  <div class="total" id="total">Total: ‚Çπ0</div>
</div>
</div>
 <!-- FLOATING CHAT BOT ICON -->
<button id="chatToggle" style="
position:fixed;
bottom:20px;
right:20px;
z-index:999;
width:60px;
height:60px;
border-radius:50%;
border:none;
background:linear-gradient(135deg,#667eea,#764ba2);
color:white;
font-size:26px;
cursor:pointer;
box-shadow:0 8px 20px rgba(0,0,0,0.3);
"> üí¨ </button>

<!-- CHAT BOT POPUP -->
<div id="chatPopup" style="
display:none;
position:fixed;
bottom:90px;
right:20px;
z-index:999;
width:560px;
height:630px;
background:#fff;
border-radius:20px;
box-shadow:0 10px 40px rgba(0,0,0,0.3);
overflow:hidden;
display:flex;
flex-direction:column;
">



  <div style="
background:linear-gradient(135deg,#667eea,#764ba2);
color:white;
padding:14px;
text-align:center;
font-weight:600;
"> ‚ú® Chat Assistant </div>

  <div id="messages" style="
flex:1;
overflow-y:auto;
padding:12px;
background:#f8f9fa;
"></div>

  <div style="
display:flex;
align-items:center;
padding:10px;
border-top:1px solid #351fa4;
gap:10px;
background:#fff;
">

   <input id="userInput" placeholder="Type or speak..." style="flex:1;padding:10px;border-radius:20px;border:1px solid #ccc;outline:none;" onkeypress="handleKeyPress(event)">

<button id="sendBtn" onclick="sendMessage()" style="padding:10px 16px;border:none;border-radius:20px;background:#667eea;color:white;"> Send </button>


  </div>

</div>

<script>
const products=[
  {id:1,name:"Engineering Books",price:500,img:"https://picsum.photos/400/300?1"},
  {id:2,name:"Scientific Calculator",price:700,img:"https://picsum.photos/400/300?2"},
  {id:3,name:"Cycle",price:2500,img:"https://picsum.photos/400/300?3"},
  {id:4,name:"Headphones",price:900,img:"https://picsum.photos/400/300?4"},
];

let cart = JSON.parse(localStorage.getItem("cart")) || [];

const productsDiv=document.getElementById("products");
const cartDiv=document.getElementById("cartItems");

function loadProducts(){
  products.forEach(p=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <img src="${p.img}">
      <h3>${p.name}</h3>
      <p>‚Çπ${p.price}</p>
      <button onclick="addToCart(${p.id})">Add to Cart</button>
    `;
    productsDiv.appendChild(div);
  });
}

function addToCart(id){
  const product=products.find(p=>p.id===id);
  cart.push(product);
  save();
}

function removeItem(i){
  cart.splice(i,1);
  save();
}

function save(){
  localStorage.setItem("cart",JSON.stringify(cart));
  renderCart();
}

function renderCart(){
  cartDiv.innerHTML="";
  let total=0;

  cart.forEach((c,i)=>{
    total+=c.price;
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <span>${c.name} - ‚Çπ${c.price}</span>
      <button onclick="removeItem(${i})">Remove</button>
    `;
    cartDiv.appendChild(div);
  });

  document.getElementById("total").innerText="Total: ‚Çπ"+total;
}

loadProducts();
renderCart();

 const API_KEY = "AIzaSyCcteX-SLq98Hg-4A2vZvn-uSIufxvQsn4";     //ENTER YOUR API KEY

const chatToggle = document.getElementById("chatToggle");
const chatPopup  = document.getElementById("chatPopup");
const messages   = document.getElementById("messages");

chatToggle.onclick = () => {
  chatPopup.style.display =
    chatPopup.style.display === "none" ? "flex" : "none";
};

function handleKeyPress(e){
  if(e.key==="Enter") sendMessage();
}

async function sendMessage(){
  const input=document.getElementById("userInput");
  const btn=document.getElementById("sendBtn");
  if(!input.value.trim()) return;

  addMsg(input.value,"user");
  const text=input.value;
  input.value = "";
input.focus();
btn.disabled = true;


  const typing=document.createElement("div");
  typing.className="bot-message";
  typing.innerHTML=`<div class="bubble typing">
    <span></span><span></span><span></span>
  </div>`;
  messages.appendChild(typing);
  messages.scrollTop=messages.scrollHeight;

  try{
    const res=await fetch(
      `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          contents:[{ parts:[{ text:text }] }]
        })
      }
    );
    const data=await res.json();
    typing.remove();
    addMsg(data.candidates[0].content.parts[0].text,"bot");
  }catch{
    typing.remove();
    addMsg("Network error ‚ùå","bot");
  }finally{
    btn.disabled=false;
  }
}

function addMsg(text,type){
  const div=document.createElement("div");
  div.className=`message ${type}-message`;
  div.innerHTML=`<div class="bubble">${escapeHtml(text)}</div>`;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}

function escapeHtml(t){
  const d=document.createElement("div");
  d.textContent=t;
  return d.innerHTML;
}

const userInput = document.getElementById("userInput");
const sendBtn   = document.getElementById("sendBtn");

/* ENTER KEY FIX */
userInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

/* BUTTON CLICK */
sendBtn.addEventListener("click", sendMessage);


</script>
</body>
</html>

